![[Pasted image 20231130231524.png]]

자동 리다이렉트 흐름 
1. 요청 : GET /event HTTP/1.1   \\n   Host: localhost:8080
2. 응답 : HTTP/1.1 301 Moved Permanently   \\n   Location: /new-event
3. 자동 리다이렉트(url이 자동 바뀜 너무 빨라서 사용자가 눈치 채기 힘듦)
4. 요청 : GET /new-event HTTP/1.1   \\n   Host: localhost:8080
5. 응답 : HTTP/1.1 200 OK   \\n   ...


### 리다이렉션 이해
종류

- 영구 리다이렉션 - 특정 리소스의 URI가 영구적으로 이동
	ex) /members -> /users
	ex) /event -> /new-event
	
- 일시 리다이렉션 - 일시적인 변경
	주문 완료 후 주문 내역 화면으로 이동
	PRG : Post/Redirect/Get
	
- 특수 리다이렉션
	결과 대신 캐시를 사용
	


#### 영구 리다이렉션 - 301, 308
- 리소스의 URI가 영구적으로 이동
- 원래의 URL을 사용X, 검색 엔진 등에서도 변경 인지
- 301 Moved Permanently
	리다이렉트시 요청 메서드가 GET으로 변하고, 본문이 제거될 수 있음(MAY)
- 308 Permanent Redirect
	301과 기능은 같음
	리다이렉트시 요청 메서드와 본문 유지(처음 POST를 보내면 리다이렉트도 POST)

301
![[Pasted image 20231130232702.png]]

308
![[Pasted image 20231130232720.png]]


정리 : 스펙이라 308을 설명했지만 사실 실무에서 /event에서 /new-event로 바뀌면 내부 데이터가 다 바뀌어버림. 그래서 웬만하면 POST로 와도 GET으로 돌리는게 맞다고 함. 그리고 301이 무조건 GET으로 변하고 본문이 제거될 수 있다고 안 적은 이유는 처음에 스펙이 POST로 보내면 POST로 리다이렉트 해줄거라고 생각했는데 GET으로 오니까 완전히 바꿀 수는 없어서 저렇게 애매하게 적었다고 함(?)
그리고 301도 많이 사용안함. 뒤에 나올 일시적인 리다이렉션을 많이 사용함.


#### 일시적인 리다이렉션 - 302, 307, 303
- 리소스의 URI가 일시적으로 변경
- 따라서 검색 엔진 등에서 URL을 변경하면 안됨
- 302 Found
	리다이렉트시 요청 메서드가 GET으로 변하고, 본문이 제거될 수 있음(MAY)
	
- 307 Temporary Redirect
	302와 기능은 같음
	리다이렉트시 요청 메서드와 본문 유지(요청 메스드를 변경하면 안된다. MUST NOT)
	
- 303 See Other
	302와 기능은 같음
	리다이렉트시 요청 메서드가 GET으로 변경
	

정리 : 302는 301처럼 스펙이 애매하게 POST로 올 줄 알고 만들었다가 저렇게 적힘. 즉, 대부분 GET으로 오긴하는데 명확하진 않음. 그래서 307, 303 나옴. 하지만 실무에선 그냥 302도 많이 쓰고 있음.


**PRG: Post/Redirect/Get**  - 꼭 써야하는 상황이 있음
일시적인 리다이렉션 예시

POST로 주문 후에 웹 브라우저를 새로고침 하면? 중복 주문이 될 수 있음.
![[Pasted image 20231130234242.png]]
물론 서버에서 상품 id 여러 개 만들어 놓고 사용된 주문번호 입니다 등 원칙적으로 서버에서 잘 처리하겠지만 그래도 클라이언트 단에서도 잘 막아두면 좋다.

- POST로 주문 후에 새로 고침으로 인한 중복 주문 방지
- POST로 주문 후에 주문 결과 화면을 GET 메서드로 리다이렉트
- 새로 고침해도 결과 화면을 GET으로 조회
- 중복 주문 대신에 결과 화면만 GET으로 다시 요청

![[Pasted image 20231130234556.png]]
즉 3. 응답에서 302, 303 을 주는 것이 중요.


#### 기타 리다이렉션 - 300, 304
- 300 Multiple Choices : 안씀
- 304 Not Found - 많이 씀, 뒤에 헤더 캐시 부분에서 자세히 설명 예정
	캐시를 목적으로 사용
	클라이언트에게 리소스가 수정되지 않았음을 알려준다. 
	따라서 클라이언트는 로컬PC에 저장된 캐시를 재사용한다. (캐시로 리다이렉트를 한다.)
	304 응답은 응답에 메시지 바디를 포함하면 안된다. (로컬 캐시를 사용해야 하므로)
	조건부 GET, HEAD 요청 시 사용
	

